# AI翻译工具使用说明

这是一个基于AI的批量文件翻译工具，专门用于将英文文档汉化为中文，支持并发处理和智能检测。

## 功能特性

### ✅ 核心功能
- **批量文件翻译** - 从files_to_translate.json读取文件路径列表进行批量处理
- **并发处理** - 同时处理5个文件，提高翻译效率
- **智能汉化检测** - 自动识别已汉化内容，避免重复翻译
- **原地覆写** - 翻译结果直接覆写原文件，保持目录结构不变
- **错误处理** - 完善的错误记录机制，跳过失败文件继续处理
- **详细日志** - 实时记录处理进度和状态
- **测试验证** - 内置测试函数验证功能正确性

### ✅ 技术特性
- **无Token限制** - 移除max_tokens限制，支持长文本完整翻译
- **自定义API配置** - 支持自定义base_url、模型、API密钥
- **文件保护** - 处理前检查文件存在性，避免程序崩溃
- **编码支持** - 全面支持UTF-8编码，确保中文正确显示

## 配置参数

### API配置
```python
BASE_URL = "https://dashscope.aliyuncs.com/compatible-mode/v1"  # 阿里云API地址
MODEL = "qwen3-235b-a22b"  # 使用的AI模型
API_KEY = "sk-5b9a273f951e459da4ad9782590d5937"  # API密钥
```

### 翻译配置
```python
MAX_CONCURRENT = 5  # 并发数量（同时处理5个文件）
TIMEOUT_SECONDS = 60  # 请求超时时间
TEMPERATURE = 0.3  # 模型温度（控制翻译的创造性）
```

### 翻译提示词
```python
TRANSLATION_PROMPT = "请将以下英文内容进行汉化，保持markdown格式或者html代码块不变，只返回汉化后的内容，不要添加任何解释，如果你发现内容已经汉化，可以直接返回"已汉化"："
```

### 文件路径配置
```python
FILES_TO_TRANSLATE_JSON = "files_to_translate.json"  # 待翻译文件列表
```


## 工作流程

### 1. 文件加载阶段
- 读取files_to_translate.json中的文件路径列表（共98个文件）
- 验证API配置的有效性
- 初始化翻译器实例

### 2. 批量处理阶段
- 按批次处理文件（每批5个文件并发）
- 对每个文件进行以下操作：
  1. 检查文件是否存在
  2. 读取文件内容
  3. 调用AI API进行汉化
  4. 处理AI响应结果

### 3. 智能判断阶段
- 如果AI返回"已汉化"：跳过该文件，标记为成功
- 如果AI返回翻译内容：直接覆写原文件
- 如果API请求失败：记录错误信息，继续处理下一个文件

### 4. 结果统计阶段
- 生成详细的处理报告
- 保存错误信息到文件
- 输出最终统计结果

## 输出文件

### 日志文件
- `translation_log.txt` - 详细的处理日志，包含每个文件的处理状态
- `translation_result.json` - 完整的翻译结果统计信息
- `translation_errors.json` - 错误详情记录（仅在有错误时生成）

### 翻译文件
- 原文件直接被翻译内容覆写
- 不生成新文件，保持原有目录结构

## 特殊处理机制

### "已汉化"检测
- AI会检测文件内容是否已经是中文
- 如果检测到已汉化，返回"已汉化"文本
- 程序识别此响应后跳过处理，避免重复翻译

### 格式保护
- 保持markdown格式不变
- 保持HTML代码块不变
- 保持代码块结构完整

### 错误恢复
- 单个文件失败不影响其他文件处理
- 详细记录错误原因和时间戳
- 支持断点续传（可重新运行处理失败的文件）

## 示例输出

```
2025-08-08 21:33:06 - INFO - 加载了 98 个文件待翻译
2025-08-08 21:33:06 - INFO - 使用配置 - API地址: https://dashscope.aliyuncs.com/compatible-mode/v1, 模型: qwen3-235b-a22b, 并发数: 5
2025-08-08 21:33:06 - INFO - 开始批量翻译，总文件数: 98, 并发数: 5
2025-08-08 21:33:06 - INFO - 处理第 1 批，文件数: 5
2025-08-08 21:33:08 - INFO - 翻译成功，原文长度: 1250, 译文长度: 890
2025-08-08 21:33:10 - INFO - 翻译完成并覆写原文件: D:\GoLearning\go-learning\challenge-1\README.md
2025-08-08 21:33:12 - INFO - 文件已汉化，跳过: D:\GoLearning\go-learning\challenge-2\hints.md
...

==================================================
翻译任务完成!
总文件数: 98
成功翻译: 95
翻译失败: 3
总耗时: 245.67秒

错误详情已保存到: translation_errors.json
完整结果已保存到: translation_result.json
```

## 注意事项

### ⚠️ 重要提醒
1. **文件备份** - 翻译会直接覆写原文件，建议提前备份重要文件
2. **API费用** - 大量文件翻译会消耗较多API tokens，注意费用控制
3. **网络稳定** - 确保网络连接稳定，避免请求超时
4. **文件编码** - 确保所有文件使用UTF-8编码


### 📁 支持的文件格式
- Markdown文件 (.md)
- HTML文件 (.html)

## 测试验证

工具包含完整的测试函数，验证以下功能：
- ✅ 翻译器实例创建
- ✅ 文件不存在检查
- ✅ 空文件处理
- ✅ 文件清理机制
- ✅ 翻译结果验证

这个工具专门为批量汉化Go学习项目的文档而设计，能够高效、智能地处理大量英文文档的翻译工作。
